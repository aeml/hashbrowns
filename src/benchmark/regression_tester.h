#ifndef HASHBROWNS_REGRESSION_TESTER_H
#define HASHBROWNS_REGRESSION_TESTER_H

#include <string>
#include <vector>
#include <optional>

namespace hashbrowns {

struct BenchmarkRow {
    std::string structure;
    double insert_ms_mean{0.0};
    double insert_ms_stddev{0.0};
    double search_ms_mean{0.0};
    double search_ms_stddev{0.0};
    double remove_ms_mean{0.0};
    double remove_ms_stddev{0.0};
    std::size_t memory_bytes{0};
};

// Parse benchmark CSV generated by BenchmarkSuite::run
std::vector<BenchmarkRow> read_benchmark_csv(const std::string& path);

struct RegressionResult {
    struct Delta { double pct{0.0}; double abs{0.0}; };
    struct Entry {
        std::string structure;
        Delta insert_delta; // positive = slower (regression) for time metrics
        Delta search_delta;
        Delta remove_delta;
        Delta memory_delta; // positive = more memory
    };
    std::vector<Entry> entries;
    bool passed{true};
    std::string summary; // human-friendly one-line summary
};

// Compare two CSVs (current vs baseline). Threshold is a percentage (e.g., 10 == 10%).
// Returns a result with per-structure deltas. 'passed' is false if any time metric increases
// beyond the threshold percentage.
RegressionResult compare_benchmarks(const std::string& current_csv,
                                    const std::string& baseline_csv,
                                    double threshold_percent);

} // namespace hashbrowns

#endif // HASHBROWNS_REGRESSION_TESTER_H
